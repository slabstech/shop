ext {
    group = 'com.slabstech.shop'

    version = '0.0.1'

    dockerRepo = 'slabstech'
}

subprojects {
    apply plugin: 'java'
    repositories {
        mavenCentral()
    }
}


// Create the docker images here, uses prebuild as multi-part images
task createClientDockerImageReactJS(type: Exec) {
//    dependsOn ":clients:reactjs:buildReactApp"
    commandLine 'docker', 'build', '--rm', '.', '-t', "${dockerRepo}/${rootProject.name}-client-reactjs", "--network" ,"host", "-f", "docker/client/reactjs/Dockerfile"
}

task createServerBuildDropwizard(type: Exec) {
    dependsOn ":servers:dropwizard:copyDependencies", ":servers:dropwizard:build"
    commandLine 'echo', 'Dropwizard Server Build Successful'
}

task createServerDockerImageDropwizard(type: Exec) {
    commandLine 'docker', 'build', '--rm', '.', '-t', "${dockerRepo}/${rootProject.name}-server-dropwizard",  "--network" ,"host", "-f", "docker/server/dropwizard/Dockerfile"
}

task createDBDockerImagePostgreSQL(type: Exec) {
    commandLine 'docker', 'build', '--rm', '.', '-t', "${dockerRepo}/${rootProject.name}-db-postgresql", "-f", "docker/db/postgresql/Dockerfile"
}


task createAppDockerImages_dropwizard(type: Exec) {
    dependsOn "createDBDockerImagePostgreSQL", "createServerDockerImageDropwizard", "createClientDockerImageReactJS"
    commandLine 'echo', 'success create images'
}


task buildAllTasks(type: Exec) {
    dependsOn createServerBuildDropwizard, ":clients:reactjs:buildReactApp"
    commandLine 'echo', 'Building all frameworks'

}


task runReactJSClient(type: Exec){
    dependsOn(":clients:reactjs:runClient")
    commandLine('echo', 'ReactJS Clieht Started')
}

task runDropWizardServer(type: Exec){
    dependsOn(":server:dropwizard:runDropwizard")
    commandLine('echo' , 'Running Dropwizard Server')
}
